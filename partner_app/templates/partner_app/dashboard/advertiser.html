{% extends "partner_app/base.html" %}
{% load static %}
{% load tz %}


{% load django_vite %}
{% vite_hmr_client %}
{% block title %}Панель управления{% endblock title %}
{% block head_js_scripts %}
{% vite_asset 'partner_app/assets/js/dashboard/advertiser.js' %}
{% endblock %}


{% block header %}
<div class="navbar bg-white shadow-lg sticky top-0 z-50" id="navbar">
    <div class="navbar-start">
        <div class="dropdown lg:hidden">
            <div tabindex="0" role="button" class="btn btn-ghost">
                <i class="fas fa-bars text-lg"></i>
            </div>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
                <li><a class="nav-item" data-page="dashboard"><i class="fas fa-chart-line mr-2"></i>Дашборд</a></li>
                <li><a class="nav-item" data-page="sales"><i class="fas fa-shopping-cart"></i>Продажи</a></li>
                <li><a class="nav-item" data-page="projects"><i class="fas fa-boxes mr-2"></i> Проекты</a></li>
                <li><a class="nav-item" data-page="partners"><i class="fas fa-handshake mr-2"></i> Партнеры</a></li>
                <li><a class="nav-item" data-page="payments"><i class="fas fa-money-bill-wave mr-2"></i> Выплаты</a></li>
            </ul>
        </div>
        <a href="{% url 'index' %}"
            class="btn btn-ghost border-none text-xl font-bold text-blue-600 hover:scale-105 transition-transform">
            <i class="fas fa-handshake text-blue-600 mr-2"></i>
            <span class="hidden sm:inline">AffiliateHub</span>
            <span class="sm:hidden">AH</span>
        </a>
    </div>
    <div class="navbar-center hidden lg:flex">
        <ul class="menu menu-horizontal px-1">
            <li><a class="nav-item btn-xs text-xs xl:text-sm flex items-center" data-page="dashboard"><i class="fas fa-chart-line mr-2"></i> Дашборд</a></li>
            <li><a class="nav-item btn-xs text-xs xl:text-sm flex items-center" data-page="sales"><i class="fas fa-shopping-cart"></i>Продажи</a></li>
            <li><a class="nav-item btn-xs text-xs xl:text-sm flex items-center" data-page="projects"><i class="fas fa-boxes mr-2"></i> Проекты</a></li>
            <li><a class="nav-item btn-xs text-xs xl:text-sm flex items-center" data-page="partners"><i class="fas fa-handshake mr-2"></i> Партнеры</a></li>
            <li><a class="nav-item btn-xs text-xs xl:text-sm flex items-center" data-page="payments"><i class="fas fa-money-bill-wave mr-2"></i> Выплаты</a></li>
        </ul>
    </div>
    <div class="navbar-end">
        <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                <div class="w-10 rounded-full bg-primary text-primary-content flex items-center justify-center">
                    <i class="fas fa-user text-lg mt-2.5 ml-0.5"></i>
                </div>
            </div>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box">
                <li><a href="{% url 'dashboard' %}" class="text-lg w-full"><i class="fas fa-user mr-1"></i> Профиль</a></li>
                <li><a class="nav-item text-lg w-full" data-page="settings"><i class="fas fa-cog"></i> Настройки</a></li>
                <li class="w-full p-0 cursor-pointer">
                    <form action="{% url 'logout' %}" class="flex justify-between w-full cursor-pointer" method="post">
                        {% csrf_token %}
                        <button type="submit"
                            class="hover:bg-gray-200 text-lg flex justify-start w-30 cursor-pointer"><i class="fas fa-sign-out-alt mr-2"></i> Выход</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block main_class %}bg-base-200 min-h-screen{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6 max-w-7xl">

    <div class="container mx-auto px-4 py-6 max-w-7xl">

        <!-- Dashboard Page -->
        <div id="dashboard" class="page-section active">
            <div class="mb-8">
                {% if request.user.first_name %}
                <h1 class="text-3xl font-bold">Добро пожаловать, {{ request.user.first_name }}!</h1>
                {% else %}
                <h1 class="text-3xl font-bold">Добро пожаловать!</h1>
                {% endif %}
                <p class="text-base-content/60">Рекламодатель с {{ request.user.date_joined|timezone:"Europe/Moscow"|date:"j E Y H:i" }}</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="card bg-gradient-to-r from-primary to-secondary text-white">
                    <div class="card-body">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm opacity-80">Баланс</p>
                                <p class="text-2xl font-bold">₽{{request.user.advertiserprofile.balance}}</p>
                            </div>
                            <i class="fas fa-wallet text-3xl opacity-80"></i>
                        </div>
                    </div>
                </div>

                <div class="card bg-gradient-to-r from-accent to-info text-white">
                    <div class="card-body">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm opacity-80">Активные партнеры</p>
                                <p class="text-2xl font-bold">{{ partners_count }}</p>
                            </div>
                            <i class="fas fa-users text-3xl opacity-80"></i>
                        </div>
                    </div>
                </div>

                <div class="card bg-gradient-to-r from-success to-warning text-white">
                    <div class="card-body">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm opacity-80">Активные проекты</p>
                                <p class="text-2xl font-bold">{{ user_projects_count }}</p>
                            </div>
                            <i class="fas fa-percentage text-3xl opacity-80"></i>
                        </div>
                    </div>
                </div>

                <div class="card bg-gradient-to-r from-warning to-error text-white">
                    <div class="card-body">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm opacity-80">Продажи</p>
                                <p class="text-2xl font-bold">142</p>
                            </div>
                            <i class="fas fa-shopping-cart text-3xl opacity-80"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left Column -->
                <div class="lg:col-span-2 space-y-6">

                    <!-- Recent Sales -->
                    <div class="card bg-base-100 shadow">
                        <div class="card-body">
                            <h2 class="card-title">
                                <i class="fas fa-history text-primary mr-2"></i>
                                Целевые действия
                            </h2>
                            <div class="space-y-4">
                                <div class="flex items-center p-3 bg-success/10 rounded-lg">
                                    <div
                                        class="w-10 h-10 bg-success text-success-content rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-shopping-cart"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-medium">Продажа #2456</p>
                                        <p class="text-sm opacity-60">Партнер: Мария Петрова</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold">₽12,540</p>
                                        <p class="text-sm opacity-60">2 часа назад</p>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-info/10 rounded-lg">
                                    <div
                                        class="w-10 h-10 bg-info text-info-content rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-shopping-cart"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-medium">Продажа #2455</p>
                                        <p class="text-sm opacity-60">Партнер: Иван Иванов</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold">₽9,870</p>
                                        <p class="text-sm opacity-60">5 часов назад</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Quick Actions -->
                    <div class="card bg-base-100 shadow">
                        <div class="card-body">
                            <h2 class="card-title">
                                <i class="fas fa-bolt text-primary mr-2"></i>
                                Быстрые действия
                            </h2>
                            <div class="space-y-2">
                                <button id="add_project_quick" class="btn btn-outline btn-block justify-start nav-item" data-page="projects">
                                    <i class="fas fa-plus mr-2"></i>
                                    Добавить проект
                                </button>
                                <button class="btn btn-outline btn-block justify-start nav-item" data-page="payments">
                                    <i class="fas fa-money-bill-wave mr-2"></i>
                                    Создать выплату
                                </button>
                            </div>
                        </div>
                    </div>
<!-- 
                     Program Stats
                    <div class="card bg-base-100 shadow">
                        <div class="card-body">
                            <h2 class="card-title">
                                <i class="fas fa-chart-pie text-primary mr-2"></i>
                                Статистика программы
                            </h2>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Конверсия</span>
                                        <span>8.5%</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Средний чек</span>
                                        <span>₽3,240</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> -->

                    <!-- Support -->
                    <div class="card bg-base-100 shadow-lg">
                        <div class="card-body">
                            <h2 class="card-title mb-4">
                                <i class="fas fa-headset text-primary mr-2"></i>
                                Поддержка
                            </h2>
                            <div class="space-y-3">
                                <div class="flex items-center">
                                    <i class="fas fa-book text-info mr-3"></i>
                                    <a href="#" class="link link-hover">База знаний</a>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-comments text-success mr-3"></i>
                                    <a href="#" class="link link-hover">Чат поддержки</a>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-envelope text-warning mr-3"></i>
                                    <a href="#" class="link link-hover">Email: support@site.com</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Page -->
        <div id="sales" class="page-section">
            <!-- Заголовок и статистика -->
            <div class="mb-6 sm:mb-8">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Продажи и конверсии</h1>
                        <p class="text-xs sm:text-sm text-gray-500 mt-1">Анализ ваших партнерских продаж и лидов</p>
                    </div>
                    <div class="stats shadow bg-base-100 w-full sm:w-auto">
                        <div class="stat p-3 sm:p-4">
                            <div class="stat-figure text-primary hidden sm:block">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-6 h-6 sm:w-8 sm:h-8 stroke-current">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                            </div>
                            <div class="stat-title text-xs sm:text-sm">Всего конверсий</div>
                            <div class="stat-value text-lg sm:text-2xl text-primary">1,248</div>
                            <div class="stat-desc text-xs">+12% за месяц</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Фильтры и временной период -->
            <div class="bg-base-100 rounded-xl shadow-sm p-3 sm:p-4 mb-6 transition-all duration-300 hover:shadow-md">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-3 sm:gap-4">
                    <div class="flex-1 w-full">
                        <form class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                            <div class="flex-1">
                                <label class="input input-sm sm:input-md input-bordered flex items-center gap-2">
                                    <input type="text" class="grow text-xs sm:text-sm" placeholder="Поиск по проектам..." />
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3 h-3 sm:w-4 sm:h-4 opacity-70">
                                        <path fill-rule="evenodd" d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z" clip-rule="evenodd" />
                                    </svg>
                                </label>
                            </div>
                            <div class="flex gap-2 sm:gap-3">
                                <select class="select select-sm sm:select-md select-bordered w-full sm:w-auto text-xs sm:text-sm">
                                    <option disabled selected>Статус</option>
                                    <option>Все</option>
                                    <option>Подтвержденные</option>
                                    <option>Ожидающие</option>
                                    <option>Отклоненные</option>
                                </select>
                                <button class="btn btn-sm sm:btn-md btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                    <span class="hidden sm:inline">Применить</span>
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="flex items-center gap-2 w-full sm:w-auto">
                        <div class="dropdown dropdown-end w-full sm:w-auto">
                            <div tabindex="0" role="button" class="btn btn-sm sm:btn-md btn-outline w-full sm:w-auto">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                <span class="text-xs sm:text-sm">30 дней</span>
                            </div>
                            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                                <li><a class="text-xs sm:text-sm">Сегодня</a></li>
                                <li><a class="text-xs sm:text-sm">Неделя</a></li>
                                <li><a class="text-xs sm:text-sm">Месяц</a></li>
                                <li><a class="text-xs sm:text-sm">Квартал</a></li>
                                <li><a class="text-xs sm:text-sm">Год</a></li>
                                <li><a class="text-xs sm:text-sm">Произвольный</a></li>
                            </ul>
                        </div>
                        <button class="btn btn-sm sm:btn-md btn-ghost">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                            </svg>
                            <span class="hidden sm:inline">Экспорт</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Графики и сводка -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
                <!-- График конверсий -->
                <div class="lg:col-span-2 bg-base-100 p-4 sm:p-6 rounded-xl shadow-sm transition-all duration-300 hover:shadow-md">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4 sm:mb-6">
                        <h2 class="text-lg sm:text-xl font-semibold">Динамика конверсий</h2>
                        <div class="tabs tabs-boxed tabs-sm sm:tabs-md">
                            <a class="tab tab-active">День</a> 
                            <a class="tab">Неделя</a> 
                            <a class="tab">Месяц</a>
                        </div>
                    </div>
                    <div class="h-48 sm:h-64">
                        <!-- Здесь будет график (заглушка) -->
                        <div class="w-full h-full bg-gradient-to-br from-primary/10 to-secondary/10 rounded-lg flex items-center justify-center text-gray-400 text-sm sm:text-base">
                            <p>График конверсий по дням</p>
                        </div>
                    </div>
                </div>

                <!-- Статистика -->
                <div class="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-1 gap-3 sm:gap-4 lg:gap-6">
                    <div class="stats shadow bg-gradient-to-br from-primary to-primary-focus text-primary-content">
                        <div class="stat p-3 sm:p-4">
                            <div class="stat-title text-xs sm:text-sm">Подтвержденные</div>
                            <div class="stat-value text-lg sm:text-2xl">874</div>
                            <div class="stat-desc text-xs">+15% за месяц</div>
                        </div>
                    </div>
                    
                    <div class="stats shadow bg-gradient-to-br from-secondary to-secondary-focus text-secondary-content">
                        <div class="stat p-3 sm:p-4">
                            <div class="stat-title text-xs sm:text-sm">Средний чек</div>
                            <div class="stat-value text-lg sm:text-2xl">₽2,450</div>
                            <div class="stat-desc text-xs">+8% за месяц</div>
                        </div>
                    </div>
                    
                    <div class="stats shadow bg-gradient-to-br from-accent to-accent-focus text-accent-content">
                        <div class="stat p-3 sm:p-4">
                            <div class="stat-title text-xs sm:text-sm">Общий доход</div>
                            <div class="stat-value text-lg sm:text-2xl">₽214,150</div>
                            <div class="stat-desc text-xs">+22% за месяц</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Таблица продаж - Адаптивная версия -->
            <div class="bg-base-100 rounded-xl shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md mb-6 sm:mb-8">
                <!-- Десктопная версия таблицы -->
                <div class="hidden sm:block overflow-x-auto">
                    <table class="table">
                        <thead>
                            <tr class="bg-base-200">
                                <th class="text-xs sm:text-sm">ID</th>
                                <th class="text-xs sm:text-sm">Проект</th>
                                <th class="text-xs sm:text-sm">Дата</th>
                                <th class="text-xs sm:text-sm">Статус</th>
                                <th class="text-xs sm:text-sm">Сумма</th>
                                <th class="text-xs sm:text-sm">Комиссия</th>
                                <th class="text-xs sm:text-sm">Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Пример строки -->
                            <tr class="hover:bg-base-200 transition-colors duration-150">
                                <td class="text-xs sm:text-sm">#24587</td>
                                <td>
                                    <div class="flex items-center gap-2 sm:gap-3">
                                        <div class="avatar">
                                            <div class="mask mask-squircle w-8 h-8 sm:w-10 sm:h-10">
                                                <img src="https://daisyui.com/images/stock/photo-1534528741775-53994a69daeb.jpg" alt="Проект" />
                                            </div>
                                        </div>
                                        <div>
                                            <div class="font-bold text-xs sm:text-sm">Курс маркетинга</div>
                                            <div class="text-xs opacity-50">AcademyPro</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-xs sm:text-sm">
                                    12.07.2025<br>
                                    <span class="opacity-70">14:32</span>
                                </td>
                                <td>
                                    <span class="badge badge-success badge-xs sm:badge-sm gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                        </svg>
                                        <span class="hidden xs:inline">Подтверждено</span>
                                    </span>
                                </td>
                                <td class="text-xs sm:text-sm">₽12,990</td>
                                <td>
                                    <span class="font-bold text-success text-xs sm:text-sm">₽1,299</span><br>
                                    <span class="text-xs opacity-70">(10%)</span>
                                </td>
                                <td>
                                    <button class="btn btn-ghost btn-xs">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                        </svg>
                                    </button>
                                </td>
                            </tr>
                            
                            <!-- Другие строки таблицы... -->
                        </tbody>
                    </table>
                </div>

                <!-- Мобильная версия таблицы (карточки) -->
                <div class="sm:hidden space-y-3 p-3">
                    <!-- Карточка продажи -->
                    <div class="card bg-base-100 shadow-sm border border-base-200">
                        <div class="card-body p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="card-title text-sm font-bold">#24587 - Курс маркетинга</h3>
                                    <p class="text-xs text-gray-500">AcademyPro</p>
                                </div>
                                <span class="badge badge-success badge-xs gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    Подтв.
                                </span>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3 text-xs">
                                <div>
                                    <div class="text-gray-500">Дата</div>
                                    <div>12.07.2025 14:32</div>
                                </div>
                                <div>
                                    <div class="text-gray-500">Сумма</div>
                                    <div class="font-medium">₽12,990</div>
                                </div>
                                <div>
                                    <div class="text-gray-500">Комиссия</div>
                                    <div class="font-medium text-success">₽1,299 (10%)</div>
                                </div>
                            </div>
                            
                            <div class="card-actions justify-end mt-3">
                                <button class="btn btn-xs btn-ghost">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                    Детали
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Другие карточки продаж... -->
                </div>
            </div>

            <!-- Пагинация -->
            <div class="join flex justify-center">
                <button class="join-item btn btn-sm sm:btn-md btn-outline">Назад</button>
                <button class="join-item btn btn-sm sm:btn-md btn-outline btn-active">1</button>
                <button class="join-item btn btn-sm sm:btn-md btn-outline">2</button>
                <button class="join-item btn btn-sm sm:btn-md btn-outline">3</button>
                <button class="join-item btn btn-sm sm:btn-md btn-outline">4</button>
                <button class="join-item btn btn-sm sm:btn-md btn-outline">Вперед</button>
            </div>

            <!-- Пустое состояние (скрыто) -->
            <div class="hidden flex flex-col justify-center items-center text-center py-8 sm:py-16" id="sales-empty-state">
                <div class="text-gray-300 text-4xl sm:text-6xl mb-4 sm:mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 sm:w-16 sm:h-16">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                </div>
                <h3 class="text-lg sm:text-xl font-medium text-gray-500 mb-2 sm:mb-3">Нет данных о продажах</h3>
                <p class="text-gray-400 text-xs sm:text-sm mb-4 sm:mb-6 max-w-md">Когда у вас появятся подтвержденные продажи, они будут отображаться в этом разделе</p>
                <button class="btn btn-sm sm:btn-md btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-1 sm:mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Как увеличить продажи?
                </button>
            </div>
        </div>

        <!-- Projects Page -->
        <div id="projects" class="page-section">
            <div class="mb-8">
                <h1 class="text-3xl font-bold">Управление проектами</h1>
                <p class="text-base-content/60">Создавайте и настраивайте проекты для партнеров</p>
            </div>

            <div class="flex sm:flew-row justify-between items-center mb-6">
                <div class="flex justify-between items-center mb-6">
                    <form method="get" action="" class="join w-full">
                        <div>
                            <div>
                                <input 
                                    name="projects_search" 
                                    class="input input-bordered join-item" 
                                    placeholder="Поиск проектов..."
                                    value="{{ projects_search_query }}"
                                >
                            </div>
                        </div>
                        <div class="indicator">
                            <button type="submit" class="btn join-item btn-primary">
                                <i class="fas fa-search mr-2"></i> Найти
                            </button>
                        </div>
                        <button type="reset" class="btn join-item"onclick="window.location.href='{{ request.path }}'">
                            <i class="fas fa-times mr-2"></i> Сбросить
                        </button>
                    </form>
                </div>

                <button class="btn btn-primary" id="create_project">
                    <i class="fas fa-plus mr-2"></i> Новый проект
                </button>
            </div>

            {% if messages %}
                {% for message in messages %}
                    {% if "project_add_error" in message.tags %}
                        <div class="alert alert-{{ message.tags }} text-red-500">
                            <b>{{ message }}</b>
                        </div>
                    {% endif %}
                {% endfor %}
            {% endif %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for project in projects %}
                <div class="card bg-base-100 shadow-md offer-card">
                    <div class="card-body pt-4">
                        <div class="flex justify-between items-start">
                            <h2 class="card-title">{{ project.name }}</h2>
                            <div
                                class="badge {% if project.is_active %}badge-success{% else %}badge-error{% endif %} gap-2">
                                <i class="fas {% if project.is_active %}fa-check{% else %}fa-times{% endif %}"></i>
                                {% if project.is_active %}Активен{% else %}Неактивен{% endif %}
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Статус:</span>
                                <span class="badge {% if project.status == 'Подтверждено' %}badge-success
                                    {% elif project.status == 'На модерации' %}badge-warning
                                    {% else %}badge-error{% endif %}">
                                    {{ project.status }}
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">URL проекта:</span>
                                <span><a href="{{ project.url }}" class="text-blue-600"
                                        target="_blank">перейти</a></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Комиссия:</span>
                                <span class="font-bold">{{ project.commission_rate }}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Партнеров:</span>
                                <span>{{ project.partners.count }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Время добавления:</span>
                                <span>{{ project.created_at|timezone:"Europe/Moscow"|date:"j E Y H:i" }}</span>
                            </div>
                        </div>
                        <div class="card-actions mt-6">
                            <button class="showProjectDetailsModal btn btn-primary btn-block" data-project-id="{{ project.id }}"
                                data-project-name="{{ project.name }}"
                                data-project-description="{{ project.description }}"
                                data-project-url="{{ project.url }}" data-project-status="{{ project.status }}"
                                data-project-is-active="{{ project.is_active|yesno:'true,false' }}"
                                data-project-partners-count="{{ project.partners.count }}"
                                data-project-commission-rate="{{ project.commission_rate }}"
                                data-project-min-payout="{{ project.min_payout }}"
                                data-project-cookie-lifetime="{{ project.cookie_lifetime }}">
                                <i class="fas fa-eye mr-2"></i> Просмотр
                            </button>
                            <button class="editProjectModal btn btn-primary btn-block"
                                    data-project-id="{{ project.id }}"
                                    data-project-name="{{ project.name }}"
                                    data-project-url="{{ project.url }}"
                                    data-project-description="{{ project.description }}"
                                    data-project-status="{{ project.status }}"
                                    data-project-is-active="{{ project.is_active|yesno:'true,false' }}"
                                    data-project-commission-rate="{{ project.commission_rate }}"
                                    data-project-cookie-lifetime="{{ project.cookie_lifetime }}"
                                    data-project-min-payout="{{ project.min_payout }}">
                            <i class="fas fa-edit mr-1"></i> Редактировать
                            </button>
                            <button class="delProjectModal btn btn-error btn-block" data-project-id="{{ project.id }}"
                                data-project-name="{{ project.name }}">
                                <i class="fas fa-trash-alt mr-2"></i> Удалить
                            </button>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full text-center py-10">
                    <p class="text-gray-500">Проекты не найдены</p>
                </div>
                {% endfor %}
            </div>
            <!-- Пагинация -->

            <div class="pagination flex flex-wrap justify-center items-center gap-2 my-6 px-2">
                {% if projects.has_previous %}
                <a href="?projects_page=1"
                    class="btn btn-sm btn-square md:btn-md btn-primary transition-all duration-200 hover:scale-105"
                    aria-label="Первая страница">
                    <i class="fas fa-angle-double-left"></i>
                </a>
                <a href="?projects_page={{ projects.previous_page_number }}"
                    class="btn btn-sm md:btn-md btn-outline transition-all duration-200 hover:scale-[1.02]">
                    <span class="hidden sm:inline">Предыдущая</span>
                    <span class="sm:hidden"><i class="fas fa-chevron-left"></i></span>
                </a>
                {% endif %}

                <div class="flex items-center mx-1 md:mx-3 text-sm md:text-base">
                    <span class="hidden sm:inline">Страница</span>
                    <input type="number" min="1" max="{{ projects.paginator.num_pages }}" value="{{ projects.number }}"
                        class="input input-bordered input-sm md:input-md w-12 md:w-16 mx-1 md:mx-2 text-center transition-all duration-200 focus:ring-2 focus:ring-primary focus:border-transparent"
                        onchange="window.location.href = '?projects_page=' + this.value" aria-label="Номер страницы">
                    <span>из {{ projects.paginator.num_pages }}</span>
                </div>

                {% if projects.has_next %}
                <a href="?projects_page={{ projects.next_page_number }}"
                    class="btn btn-sm md:btn-md btn-outline transition-all duration-200 hover:scale-[1.02]">
                    <span class="hidden sm:inline">Следующая</span>
                    <span class="sm:hidden"><i class="fas fa-chevron-right"></i></span>
                </a>
                <a href="?projects_page={{ projects.paginator.num_pages }}"
                    class="btn btn-sm btn-square md:btn-md btn-primary transition-all duration-200 hover:scale-105"
                    aria-label="Последняя страница">
                    <i class="fas fa-angle-double-right"></i>
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Partners Page -->
        <div id="partners" class="page-section px-4 sm:px-0">
            <div class="mb-6 sm:mb-8">
                <h1 class="text-2xl sm:text-3xl font-bold text-base-content">Партнеры</h1>
                <p class="text-sm sm:text-base text-base-content/60">Управление партнерами вашей программы</p>
            </div>

            <div class="card bg-base-100 shadow-sm sm:shadow-lg">
                <div class="card-body p-2 sm:p-4 md:p-6">
                    <div class="flex sm:flew-row justify-between items-center mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <form method="get" action="" class="join w-full">
                                <div>
                                    <div>
                                        <input 
                                            name="partners_search" 
                                            class="input input-bordered join-item" 
                                            placeholder="Поиск партнёров..."
                                            value="{{ partners_search_query }}"
                                        >
                                    </div>
                                </div>
                                <div class="indicator">
                                    <button type="submit" class="btn join-item btn-primary">
                                        <i class="fas fa-search mr-2"></i> Найти
                                    </button>
                                </div>
                                <button type="reset" class="btn join-item"onclick="window.location.href='{{ request.path }}'">
                                    <i class="fas fa-times mr-2"></i> Сбросить
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Мобильный вид (карточки) -->
                    <div class="space-y-2 xs:space-y-3 sm:hidden">
                        {% for partner in partners %}
                        <div class="card bg-base-100 shadow-xs">
                            <div class="card-body p-2 sm:p-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <div class="overflow-hidden">
                                            <div class="font-bold text-sm sm:text-base truncate">
                                                {{ partner.get_full_name|default:partner.username }}
                                            </div>
                                            <div class="text-xs opacity-50 truncate">{{ partner.email }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="divider my-1 sm:my-2"></div>
                                <div class="grid grid-cols-2 gap-1 sm:gap-2">
                                    <div>
                                        <div class="text-xs text-base-content/60">Тип</div>
                                        <div class="text-sm sm:text-base">
                                            {{ partner.partnerprofile.traffic_source|default:"Не указан" }}
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-base-content/60">Продажи</div>
                                        <div class="text-sm sm:text-base">
                                            {{ partner.get_conversions_count|default:"0" }}
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-base-content/60">Доход</div>
                                        <div class="font-bold text-sm sm:text-base">
                                            ₽{{ partner.get_total_income|default:"0" }}
                                        </div>
                                    </div>
                                    <div class="flex items-end justify-end">
                                        <div class="dropdown dropdown-end">
                                            <button tabindex="0" class="btn btn-ghost btn-xs sm:btn-sm">
                                                <i class="fas fa-eye text-xs sm:text-sm"></i>
                                            </button>
                                            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-48 sm:w-52">
                                                <li>
                                                    <a href="{% url 'partner' partner.id %}" class="text-xs sm:text-sm">
                                                        <i class="fa-solid fa-circle-user"></i>Просмотр
                                                    </a>
                                                </li>
                                                <li class="menu-title mt-1 sm:mt-2 text-xs sm:text-sm">
                                                    <span>Администрирование</span>
                                                </li>
                                                <li>
                                                    <a class="text-xs sm:text-sm text-error">
                                                        <i class="fas fa-trash-alt mr-1 sm:mr-2"></i>Удалить
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-8 text-gray-400">
                            Партнёры не найдены
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Десктопный вид (таблица) -->
                    <div class="hidden sm:block">
                        <div class="overflow-visible">
                            <table class="table table-sm md:table-md">
                                <thead>
                                    <tr>
                                        <th class="py-1 sm:py-2">Партнер</th>
                                        <th class="py-1 sm:py-2">Тип</th>
                                        <th class="py-1 sm:py-2">Продажи</th>
                                        <th class="py-1 sm:py-2">Доход</th>
                                        <th class="py-1 sm:py-2">Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for partner in partners %}
                                    <tr>
                                        <td>
                                            <div class="flex items-center gap-2 sm:gap-3">
                                                <div>
                                                    <div class="font-bold text-sm sm:text-base">
                                                        {{ partner.get_full_name|default:partner.username }}
                                                    </div>
                                                    <div class="text-xs sm:text-sm opacity-50">
                                                        {{ partner.email }}
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-sm sm:text-base">
                                            {{ partner.partnerprofile.traffic_source|default:"Не указан" }}
                                        </td>
                                        <td class="text-sm sm:text-base">
                                            {{ partner.get_conversions_count|default:"0" }}
                                        </td>
                                        <td class="text-sm sm:text-base">
                                            ₽{{ partner.get_total_income|default:"0" }}
                                        </td>
                                        <td>
                                            <div class="dropdown dropdown-end">
                                                <button tabindex="0" class="btn btn-ghost btn-xs sm:btn-sm">
                                                    <i class="fas fa-eye text-xs sm:text-sm"></i>
                                                </button>
                                                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-48 sm:w-52">
                                                    <li>
                                                        <a href="{% url 'partner' partner.id %}" class="text-xs sm:text-sm">
                                                            <i class="fa-solid fa-circle-user"></i>Просмотр
                                                        </a>
                                                    </li>
                                                    <li class="menu-title mt-1 sm:mt-2 text-xs sm:text-sm">
                                                        <span>Администрирование</span>
                                                    </li>
                                                    <li>
                                                        <a class="text-xs sm:text-sm text-error">
                                                            <i class="fas fa-trash-alt mr-1 sm:mr-2"></i>Удалить
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="6" class="text-center py-6">
                                            <div class="text-gray-400">Партнёры не найдены</div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Пагинация Партнёры -->
                    <div class="pagination flex flex-wrap justify-center items-center gap-2 my-6 px-2">
                        {% if partners.has_previous %}
                        <a href="?partners_page=1"
                            class="btn btn-sm btn-square md:btn-md btn-primary transition-all duration-200 hover:scale-105"
                            aria-label="Первая страница">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                        <a href="?partners_page={{ partners.previous_page_number }}"
                            class="btn btn-sm md:btn-md btn-outline transition-all duration-200 hover:scale-[1.02]">
                            <span class="hidden sm:inline">Предыдущая</span>
                            <span class="sm:hidden"><i class="fas fa-chevron-left"></i></span>
                        </a>
                        {% endif %}

                        <div class="flex items-center mx-1 md:mx-3 text-sm md:text-base">
                            <span class="hidden sm:inline">Страница</span>
                            <input type="number" min="1" max="{{ partners.paginator.num_pages }}" value="{{ partners.number }}"
                                class="input input-bordered input-sm md:input-md w-12 md:w-16 mx-1 md:mx-2 text-center transition-all duration-200 focus:ring-2 focus:ring-primary focus:border-transparent"
                                onchange="window.location.href = '?partners_page=' + this.value" aria-label="Номер страницы">
                            <span>из {{ partners.paginator.num_pages }}</span>
                        </div>

                        {% if partners.has_next %}
                        <a href="?partners_page={{ partners.next_page_number }}"
                            class="btn btn-sm md:btn-md btn-outline transition-all duration-200 hover:scale-[1.02]">
                            <span class="hidden sm:inline">Следующая</span>
                            <span class="sm:hidden"><i class="fas fa-chevron-right"></i></span>
                        </a>
                        <a href="?partners_page={{ partners.paginator.num_pages }}"
                            class="btn btn-sm btn-square md:btn-md btn-primary transition-all duration-200 hover:scale-105"
                            aria-label="Последняя страница">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Payments Page -->
        <div id="payments" class="page-section">
            <div class="mb-8">
                <h1 class="text-3xl font-bold">Выплаты</h1>
                <p class="text-base-content/60">История выплат партнерам</p>
            </div>

            <div class="card bg-base-100 shadow">
                <div class="card-body">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <h2 class="card-title">
                            <i class="fas fa-money-bill-wave text-primary mr-2"></i>
                            История выплат
                        </h2>
                        <div class="flex gap-2">
                            <button class="btn btn-primary">
                                <i class="fas fa-plus mr-2"></i>
                                Новая выплата
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Дата</th>
                                    <th>Партнер</th>
                                    <th>Сумма</th>
                                    <th>Статус</th>
                                    <th>Детали</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>15.06.2024</td>
                                    <td>Мария Петрова</td>
                                    <td class="font-bold">₽12,540</td>
                                    <td><span class="badge badge-success">Выплачено</span></td>
                                    <td>
                                        <button class="btn btn-ghost btn-xs">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>10.06.2024</td>
                                    <td>Иван Иванов</td>
                                    <td class="font-bold">₽9,870</td>
                                    <td><span class="badge badge-success">Выплачено</span></td>
                                    <td>
                                        <button class="btn btn-ghost btn-xs">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page-section">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-base-content mb-2">Настройки</h1>
                <p class="text-base-content/60">Управление аккаунтом и настройки профиля</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-6">
                    <!-- Profile Settings -->
                <div class="card bg-base-100 shadow-lg">
                    <div class="card-body p-4 sm:p-6">
                        <h2 class="card-title text-xl sm:text-2xl mb-4 sm:mb-6">
                            <i class="fas fa-user text-primary mr-2"></i>
                            Профиль
                        </h2>
                        
                        <form method="POST" action="{% url 'dashboard' %}" id="profile_settings_form" class="space-y-4">
                            {% csrf_token %}
                            <input name="profile_submit" type="hidden" value="1" />
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <!-- Имя -->
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text">Имя</span>
                                    </label>
                                    <input name="first_name" type="text" value="{{ request.user.first_name }}"
                                        class="input input-bordered w-full" required />
                                </div>
                                
                                <!-- Фамилия -->
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text">Фамилия</span>
                                    </label>
                                    <input name="last_name" type="text" value="{{ request.user.last_name }}"
                                        class="input input-bordered w-full" required />
                                </div>
                                
                                <!-- Email -->
                                <div class="form-control sm:col-span-2">
                                    <label class="label">
                                        <span class="label-text">Email</span>
                                    </label>
                                    <input name="email" type="email" value="{{ request.user.email }}"
                                        class="input input-bordered w-full" required />
                                </div>
                                
                                <!-- Телефон -->
                                <div class="form-control sm:col-span-2">
                                    <label class="label">
                                        <span class="label-text">Телефон</span>
                                    </label>
                                    <input name="phone" type="tel" value="{{ request.user.phone|default:'' }}"
                                        class="input input-bordered w-full" required />
                                    <label class="label">
                                        <span class="label-text-alt">Формат: +7 (XXX) XXX-XX-XX</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- О себе -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">
                                        О себе
                                    </span>
                                </label>
                                
                                <div class="relative group">
                                    <textarea 
                                        name="description" 
                                        class="textarea w-full"
                                        placeholder="Расскажите о своих интересах, опыте и целях..."
                                        data-min-length="20"
                                    >{{ request.user.description }}</textarea>
                                </div>
                            </div>
                            
                            <!-- Кнопка сохранения -->
                            <div class="flex justify-end mt-6">
                                <button type="submit" class="btn btn-primary w-full sm:w-auto">
                                    <i class="fas fa-save mr-2"></i>
                                    Сохранить изменения
                                </button>
                            </div>
                        </form>
                        
                        <!-- Сообщения об ошибках/успехе -->
                        {% if messages %}
                            <div class="mt-4 space-y-2">
                                {% for message in messages %}
                                    {% if "profile_update_error" in message.tags %}
                                        <div class="alert alert-error">
                                            <i class="fas fa-exclamation-circle mr-2"></i>
                                            <span>{{ message }}</span>
                                        </div>
                                    {% endif %}
                                    {% if "profile_update_success" in message.tags %}
                                        <div class="alert alert-success">
                                            <i class="fas fa-check-circle mr-2"></i>
                                            <span>{{ message }}</span>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                    <!-- Security Settings -->
                <div class="card bg-base-100 shadow-lg">
                    <div class="card-body p-6">
                        <h2 class="card-title text-xl sm:text-2xl mb-6 flex items-center">
                            <i class="fas fa-shield-alt text-primary mr-3 text-2xl"></i>
                            <span>
                                Безопасность аккаунта
                            </span>
                        </h2>
                        
                        <form id="change_password_form" action="{% url 'dashboard' %}" class="space-y-6" method="POST">
                            {% csrf_token %}
                            <input name="password_submit" value="1" class="hidden">
                            
                            <!-- Текущий пароль -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">
                                        Текущий пароль
                                    </span>
                                </label>
                                <div class="relative">
                                    <input name="old_password" type="password" 
                                        class="input input-bordered w-full"
                                        placeholder="••••••••" required />
                                </div>
                            </div>
                            
                            <!-- Новый пароль -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">
                                        Новый пароль
                                    </span>
                                </label>
                                <div class="relative">
                                    <input name="password1" type="password" 
                                        class="input input-bordered w-full"
                                        placeholder="Придумайте надежный пароль" 
                                        data-min-length="8"
                                        required />
                                </div>
                            </div>
                            
                            <!-- Подтверждение пароля -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">
                                        Подтвердите пароль
                                    </span>
                                </label>
                                <div class="relative">
                                    <input name="password2" type="password" class="input input-bordered w-full"
                                    placeholder="Повторите новый пароль" required />
                                </div>
                                <div class="password-match mt-1 hidden text-sm">
                                    <i class="fas fa-check-circle text-success mr-1"></i>
                                    <span class="text-success">Пароли совпадают</span>
                                </div>
                            </div>
                            
                            <!-- Кнопка отправки -->
                            <div class="card-actions justify-end mt-8">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-key mr-2"></i>
                                    Обновить пароль
                                </button>
                            </div>
                        </form>
                        
                        <!-- Сообщения об ошибках/успехе -->
                        {% if messages %}
                            <div class="mt-6 space-y-3">
                                {% for message in messages %}
                                    {% if "password_update_error" in message.tags %}
                                        <div class="alert alert-error shadow-lg">
                                            <div>
                                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                                <span>{{ message }}</span>
                                            </div>
                                        </div>
                                    {% endif %}
                                    {% if "password_update_success" in message.tags %}
                                        <div class="alert alert-success shadow-lg">
                                            <div>
                                                <i class="fas fa-check-circle mr-2"></i>
                                                <span>{{ message }}</span>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                </div>

                <div class="space-y-6">
                    <!-- Notification Settings -->
                    <div class="card bg-base-100 shadow-lg">
                        <div class="card-body">
                            <h2 class="card-title mb-4">
                                <i class="fas fa-bell text-primary mr-2"></i>
                                Уведомления
                            </h2>
                            <form class="space-y-4" method="post" action="{% url 'update_notifications_settings' %}">
                                {% csrf_token %}
                                <div class="form-control">
                                    <label class="label cursor-pointer flex justify-between">
                                        <span class="label-text">Email уведомления</span>
                                        <input name="email_notifications"  type="checkbox" class="toggle toggle-primary" {% if user.email_notifications %}checked{% endif %}/>
                                    </label>
                                </div>
                                <div class="card-actions flex justify-end mt-4">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save mr-2"></i>
                                        Сохранить изменения
                                    </button>
                                </div>
                            </form>
                            {% if messages %}
                                {% for message in messages %}
                                    {% if "update_notifications_success" in message.tags %}
                                        <div class="alert alert-{{ message.tags }} text-green-500">
                                            <b>{{ message }}</b>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>

                    <!-- API Settings -->
                    <div class="card bg-base-100 shadow-lg">
                        <div class="card-body">
                            <h2 class="card-title mb-4">
                                <i class="fas fa-code text-primary mr-2"></i>
                                API настройки
                            </h2>
                            <form id="apiSettingsForm" method="post" action="{% url 'update_api_settings' %}">
                                {% csrf_token %}
                                <div class="space-y-4">
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text">{{ apiSettingsForm.api_key.label }}</span>
                                        </label>
                                        <div class="join w-full">
                                            {{ apiSettingsForm.api_key|default:"" }}
                                            <button type="button" id="show_api_key" class="btn join-item">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button type="button" id="copy_api_key" class="btn join-item">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <button type="button" id="generate_api_key" class="btn btn-outline btn-block">
                                        <i class="fas fa-sync mr-2"></i>
                                        Сгенерировать новый ключ
                                    </button>

                                    <button type="submit" class="btn btn-primary btn-block">
                                        <i class="fas fa-save mr-2"></i> Сохранить API-ключ
                                    </button>

                                    <div class="text-sm text-base-content/60">
                                        <p>
                                            <i class="fas fa-info-circle mr-1"></i> API документация доступна в разделе
                                            помощи
                                        </p>
                                    </div>
                                </div>
                            </form>
                            {% if messages %}
                                {% for message in messages %}
                                    {% if "update_api_error" in message.tags %}
                                        <div class="alert alert-{{ message.tags }} text-red-500">
                                            <b>{{ message }}</b>
                                        </div>
                                    {% endif %}
                                    {% if "update_api_success" in message.tags %}
                                        <div class="alert alert-{{ message.tags }} text-green-500">
                                            <b>{{ message }}</b>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

    <!-- Модальное окно создания проекта -->
    <dialog id="createProjectModal" class="modal backdrop-blur-sm">
        <div class="modal-box max-w-2xl bg-white rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Создание нового проекта</h2>

            <form method="post" action="{% url 'add_project' %}">
                {% csrf_token %}

                <!-- Название проекта -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        {{ projectForm.name.label }}
                    </label>
                    {{ projectForm.name }}
                    {% if projectForm.name.errors %}
                    <div class="text-red-500 text-xs mt-1">{{ projectForm.name.errors }}</div>
                    {% endif %}
                </div>

                <!-- Описание -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        {{ projectForm.description.label }}
                    </label>
                    {{ projectForm.description }}
                </div>

                <!-- URL проекта -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        {{ projectForm.url.label }}
                    </label>
                    {{ projectForm.url }}
                    {% if projectForm.url.errors %}
                    <div class="text-red-500 text-xs mt-1">{{ projectForm.url.errors }}</div>
                    {% endif %}
                </div>

                <!-- Минимальная выплата -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        {{ projectForm.min_payout.label }}
                    </label>
                    {{ projectForm.min_payout }}
                    {% if projectForm.min_payout.errors %}
                    <div class="text-red-500 text-xs mt-1">{{ projectForm.min_payout.errors }}</div>
                    {% endif %}
                </div>

                <!-- Комиссия и Куки -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            {{ projectForm.commission_rate.label }}
                        </label>
                        {{ projectForm.commission_rate }}
                        {% if projectForm.commission_rate.errors %}
                        <div class="text-red-500 text-xs mt-1">{{ projectForm.commission_rate.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            {{ projectForm.cookie_lifetime.label }}
                        </label>
                        {{ projectForm.cookie_lifetime }}
                    </div>
                </div>

                <!-- Кнопки действий -->
                <div class="flex justify-end gap-3">
                    <a id="close_create_project_modal" class="btn btn-ghost">Отмена</a>
                    <button type="submit" class="btn btn-primary">Добавить проект</button>
                </div>
            </form>
        </div>
    </dialog>


    <dialog id="projectDetailsModal" class="modal backdrop-blur-sm">
        <div class="modal-box max-w-5xl p-0 overflow-y-auto max-h-screen">

            <!-- Header -->
            <div class="bg-gradient-to-r from-primary to-primary-focus p-6 pt-12 text-white">
                <h3 id="ProjectTitle" class="text-xl font-bold">Летняя распродажа 2023</h3>
                <div class="flex flex-wrap items-center mt-2 gap-2">
                    <div id="ProjectStatusBadge" class="badge badge-accent">
                        <p id="ProjectStatusText">Активный</p>
                    </div>
                </div>
            </div>

            <!-- Body content -->
            <div class="p-4 space-y-4">
                <!-- Project Info -->
                <div class="card bg-base-100 shadow-sm">
                    <div class="card-body p-4">
                        <h4 class="card-title text-lg">
                            Описание проекта
                        </h4>
                        <p id="ProjectDescription" class="mt-2 text-gray-600 text-sm">
                            Описание
                        </p>
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="card bg-base-100 shadow-sm">
                    <div class="card-body p-4">
                        <h4 class="card-title text-lg">
                            Статистика
                        </h4>
                        <div class="grid grid-cols-2 gap-2 mt-3">
                            <div class="stats shadow compact">
                                <div class="stat p-2">
                                    <div class="stat-title text-xs">Партнёров</div>
                                    <div id="ProjectPartnersCount" class="stat-value text-primary text-lg">24</div>
                                </div>
                            </div>
                            <div class="stats shadow compact">
                                <div class="stat p-2">
                                    <div class="stat-title text-xs">Конверсия</div>
                                    <div id="ProjectConversion" class="stat-value text-secondary text-lg">0%</div>
                                </div>
                            </div>
                            <div class="stats shadow compact w-full">
                                <div class="stat p-2">
                                    <div class="stat-title text-xs">Комиссия</div>
                                    <div id="ProjectComissionRate" class="stat-value text-lg">15%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Offer Details -->
                <div class="card bg-base-100 shadow-sm">
                    <div class="card-body p-4">
                        <h4 class="card-title text-lg">
                            Условия
                        </h4>
                        <div class="space-y-2 mt-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Минимальная выплата:</span>
                                <span id="MinPayout" class="font-medium">1 000 ₽</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Срок cookie-файлов:</span>
                                <span id="CookiePeriod" class="font-medium">30 дней</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="modal-action bg-base-200 p-3 sticky bottom-0">
                <button id="closeProjectDetailsModal" class="btn btn-sm w-full">Закрыть</button>
            </div>
        </div>
    </dialog>

    <dialog id="deleteProjectModal" class="modal backdrop-blur-sm">
        <div class="modal-box max-w-md">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
            </form>
            
            <div class="text-center">
                <div class="mx-auto w-16 h-16 flex items-center justify-center rounded-full bg-error/20 mb-4">
                    <i class="fas fa-exclamation-triangle text-error text-2xl"></i>
                </div>
                
                <h3 class="text-lg font-bold mb-2">Удаление проекта</h3>
                <p class="text-gray-600 mb-6">
                    Вы действительно хотите удалить проект <span id="projectNameToDelete" class="font-semibold text-primary"></span>?
                </p>
                <p class="text-sm text-error mb-6">
                    <i class="fas fa-info-circle mr-1"></i> Это действие нельзя отменить!
                </p>
            
                <div class="flex justify-center gap-4">
                    <form method="dialog" class="flex-1">
                    <button class="btn btn-outline w-full">
                        <i class="fas fa-times mr-2"></i> Отмена
                    </button>
                    </form>
                    
                    <form id="deleteProjectForm" method="POST" class="flex-1">
                    {% csrf_token %}
                    <input type="hidden" name="project_id" id="projectIdInput">
                    <button type="submit" class="btn btn-error w-full">
                        <i class="fas fa-trash-alt mr-2"></i> Удалить
                    </button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Затемнение фона -->
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <dialog id="editProjectModal" class="modal backdrop-blur-sm">
        <div class="modal-box max-w-2xl">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
            </form>
    
            <h3 class="text-xl font-bold mb-6">Редактирование проекта</h3>
        
            <form id="editProjectForm" method="POST" class="space-y-4">
                {% csrf_token %}
                <input type="hidden" name="project_id" id="editProjectId">
                
                <!-- Основная информация -->
                    <!-- Название -->
                    <div class="form-control">
                    <label class="label">
                        <span class="label-text">Название проекта</span>
                    </label>
                    <input type="text" name="name" id="editProjectName" 
                            class="input input-bordered w-full" required
                            minlength="3" placeholder="Например: Интернет магазин" required>
                    </div>
                
                <!-- URL и Cookie -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- URL -->
                    <div class="form-control">
                    <label class="label">
                        <span class="label-text">URL или ID</span>
                    </label>
                    <input type="text" name="url" id="editProjectUrl" 
                            class="input input-bordered w-full" required
                            placeholder="Ссылка или идентификатор" required>
                    </div>
                    
                    <!-- Срок cookie -->
                    <div class="form-control">
                    <label class="label">
                        <span class="label-text">Срок действия cookie (дней)</span>
                    </label>
                    <input type="number" name="cookie_lifetime" id="editProjectCookie" 
                            class="input input-bordered w-full" min="0"
                            value="30" required>
                    </div>
                </div>
                
                <!-- Комиссия и мин. выплата -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Комиссия -->
                    <div class="form-control">
                    <label class="label">
                        <span class="label-text">Комиссия (%)</span>
                    </label>
                    <input type="number" name="commission_rate" id="editProjectCommission" 
                            class="input input-bordered w-full" min="0" max="100"
                            value="0" required>
                    </div>
                    
                    <!-- Мин. выплата -->
                    <div class="form-control">
                    <label class="label">
                        <span class="label-text">Мин. выплата</span>
                    </label>
                    <input type="number" name="min_payout" id="editProjectMinPayout" 
                            class="input input-bordered w-full" min="0" step="0.01"
                            value="0" required>
                    </div>
                </div>
                
                <!-- Описание -->
                    <div class="form-control">
                        <label class="label">
                        <span class="label-text">Описание проекта</span>
                        </label>
                        <textarea name="description" id="editProjectDescription" 
                                class="textarea textarea-bordered w-full h-24" required
                                minlength="15" placeholder="Подробное описание проекта">
                        </textarea>
                    </div>
                
                <!-- Статус и активность -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">        
                    <!-- Активность -->
                    <div class="form-control">
                    <label class="label cursor-pointer justify-start gap-3">
                        <input type="checkbox" name="is_active" id="editProjectActive" 
                            class="toggle toggle-primary" checked>
                        <span class="label-text">Проект активен/неактивен</span>
                    </label>
                    </div>
                </div>
                
                <!-- Кнопки -->
                <div class="modal-action">
                    <button type="button" onclick="document.getElementById('editProjectModal').close()" 
                            class="btn btn-outline">
                    Отмена
                    </button>
                    <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save mr-2"></i> Сохранить изменения
                    </button>
                </div>
            </form>
        </div>
        <!-- Затемнение фона -->
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <dialog id="partnerDetailsModal" class="modal backdrop-blur-sm">
        <div class="modal-box max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-start mb-4">
            <h3 class="text-xl font-bold">Подробная информация о партнёре</h3>
            <button onclick="document.getElementById('partnerDetailsModal').close()" 
                    class="btn btn-sm btn-circle">
                ✕
            </button>
            </div>
            
            <!-- Основная информация -->
            <div class="flex items-start gap-4 mb-6">
            <div class="flex-1">
                <h4 class="text-lg font-semibold">
                <span id="partnerFirstName"></span> 
                <span id="partnerLastName"></span>
                </h4>
                <div class="space-y-1 mt-2">
                <p><strong>Email:</strong> <span id="partnerEmail"></span></p>
                <p><strong>Телефон:</strong> <span id="partnerPhone"></span></p>
                <p><strong>Описание:</strong> <span id="partnerDescription"></span></p>
                </div>
            </div>
            </div>
            
            <!-- Площадки партнёра -->
            <div>
            <h4 class="font-medium mb-3 border-b pb-2">Площадки партнёра</h4>
            <div class="space-y-4" id="partnerPlatforms">
                <!-- Площадки будут добавляться динамически -->
                <p class="text-gray-400">Загрузка данных...</p>
            </div>
            </div>
            
            <div class="modal-action mt-4">
            <button onclick="document.getElementById('partnerDetailsModal').close()" 
                    class="btn">
                Закрыть
            </button>
            </div>
        </div>
    </dialog>
{% endblock content %}