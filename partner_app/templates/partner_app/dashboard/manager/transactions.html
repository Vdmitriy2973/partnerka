<div id="transactions" class="page-section max-w-7xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold">Выплаты партнёрам</h1>
        <p class="text-base-content/60">Модерация запросов на вывод средств</p>
    </div>

    <!-- Фильтры и поиск -->
    <!-- <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div class="join w-full md:w-auto">
            <div>
                <input class="input input-bordered join-item w-full" placeholder="Поиск по имени, email или ID...">
            </div>
            <select class="select select-bordered join-item">
                <option disabled selected>Статус</option>
                <option>Все</option>
                <option>Ожидают</option>
                <option>Одобрены</option>
                <option>Отклонены</option>
                <option>Завершены</option>
            </select>
            <select class="select select-bordered join-item">
                <option disabled selected>Период</option>
                <option>Сегодня</option>
                <option>Неделя</option>
                <option>Месяц</option>
                <option>Все время</option>
            </select>
            <div class="indicator">
                <button class="btn join-item btn-primary">
                    <i class="fas fa-filter mr-2"></i> Применить
                </button>
            </div>
        </div>

        <div class="stats shadow bg-base-100 w-full md:w-auto">
            <div class="stat">
                <div class="stat-title">Всего выплат</div>
                <div class="stat-value text-primary">125,430 ₽</div>
                <div class="stat-desc">24 запроса</div>
            </div>
        </div>
    </div> -->

    <!-- Таблица выплат -->
    <div class="overflow-x-auto bg-base-100 rounded-box shadow">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Партнёр</th>
                    <th>Сумма</th>
                    <th>Реквизиты</th>
                    <th>Дата запроса</th>
                    <th>Статус</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                <!-- Пример строки с выплатой в ожидании -->
                {% for transaction in pending_transactions %}
                <tr class="hover:bg-base-200 transition-colors">
                    <td>{{ transaction.id }}</td>
                    <td>
                        <div class="flex items-center gap-3">
                            <div>
                                <div class="font-bold"><a href="{% url 'partner' transaction.partner.id %}">{{ transaction.partner.get_full_name }}</a></div>
                                <div class="text-sm opacity-50">{{ transaction.partner.email }}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="font-bold text-lg">{{ transaction.amount }} ₽</span>
                    </td>
                    <td>
                        <div class="flex flex-col">
                            {% if transaction.payment_method == "card" %}
                                <span class="font-medium">Банковская карта</span>
                                <span class="text-sm text-gray-500 truncate max-w-[180px]">
                                    {{ transaction.partner.payout_settings.card_number|truncatechars:6 }}
                                </span>
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        {{ transaction.date|date:"d.m.Y H:i" }} 
                    </td>
                    <td>
                        <span class="badge badge-warning">
                            {{ transaction.status }}
                        </span>
                    </td>
                    <td>
                        <div class="flex gap-2">
                            <button class="btn btn-sm btn-success approve-btn" 
                                data-transaction-id="{{ transaction.id }}"
                                data-transaction-partner-id="{{ transaction.partner.id }}"
                                data-transaction-partner="{{ transaction.partner.get_full_name }}"
                                data-transaction-partner-email="{{ transaction.partner.email }}"
                                data-transaction-amount="{{ transaction.amount }}"
                                data-transaction-method="{{ transaction.payment_method }}"
                                {% if transaction.payment_method == 'card' %}
                                data-transaction-card-number ="{{ transaction.partner.payout_settings.card_number|truncatechars:6 }}"
                                data-transaction-card-owner ="{{ transaction.partner.payout_settings.cardholder_name }}"
                                data-transaction-bank-name ="{{ transaction.partner.payout_settings.bank_name }}"
                                {% endif %}
                                data-transaction-date="{{ transaction.date|date:'d.m.Y H:i' }}"
                                data-transaction-status="{{ transaction.status }}">
                                <i class="fas fa-check mr-1"></i> Одобрить
                            </button>
                            <button class="btn btn-sm btn-error reject-btn" 
                                data-transaction-id="{{ transaction.id }}"
                                data-transaction-partner-id="{{ transaction.partner.id }}"
                                data-transaction-partner="{{ transaction.partner.get_full_name }}"
                                data-transaction-partner-email="{{ transaction.partner.email }}"
                                data-transaction-amount="{{ transaction.amount }}"
                                data-transaction-method="{{ transaction.payment_method }}"
                                {% if transaction.payment_method == 'card' %}
                                data-transaction-card-number ="{{ transaction.partner.payout_settings.card_number|truncatechars:6 }}"
                                data-transaction-card-owner ="{{ transaction.partner.payout_settings.cardholder_name }}"
                                data-transaction-bank-name ="{{ transaction.partner.payout_settings.bank_name }}"
                                {% endif %}
                                data-transaction-date="{{ transaction.date|date:'d.m.Y H:i' }}"
                                data-transaction-status="{{ transaction.status }}">
                                <i class="fas fa-times mr-1"></i> Отклонить
                            </button>
                            <button class="btn btn-sm btn-outline details-btn" 
                                data-transaction-id="{{ transaction.id }}"
                                data-transaction-partner-id="{{ transaction.partner.id }}"
                                data-transaction-partner="{{ transaction.partner.get_full_name }}"
                                data-transaction-partner-email="{{ transaction.partner.email }}"
                                data-transaction-amount="{{ transaction.amount }}"
                                data-transaction-method="{{ transaction.payment_method }}"
                                {% if transaction.payment_method == 'card' %}
                                data-transaction-card-number ="{{ transaction.partner.payout_settings.card_number|truncatechars:6 }}"
                                data-transaction-card-owner ="{{ transaction.partner.payout_settings.cardholder_name }}"
                                data-transaction-bank-name ="{{ transaction.partner.payout_settings.bank_name }}"
                                {% endif %}
                                data-transaction-date="{{ transaction.date|date:'d.m.Y H:i' }}"
                                data-transaction-status="{{ transaction.status }}">
                                <i class="fas fa-info-circle mr-1"></i> Подробнее
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if not pending_transactions %}
            <div class="flex flex-col justify-center items-center text-center py-10" id="empty-state">
                <div class="text-gray-300 text-5xl mb-4">
                    <i class="fas fa-link"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-500 mb-2">Нет транзакций на выплаты</h3>
                <p class="text-gray-400 text-sm mb-4">Здесь будут отображаться транзакции партнёров</p>
            </div>
        {% endif %}
    </div>

    <!-- Пагинация -->
    <div class="pagination flex flex-wrap justify-center items-center gap-2 my-6 px-2">
        {% if pending_transactions.has_previous %}
        <a href="?transactions_page=1"
            class="btn btn-sm btn-square md:btn-md btn-primary transition-all duration-200 hover:scale-105"
            aria-label="Первая страница">
            <i class="fas fa-angle-double-left"></i>
        </a>
        <a href="?transactions_page={{ pending_transactions.previous_page_number }}"
            class="btn btn-sm md:btn-md btn-outline transition-all duration-200 hover:scale-[1.02]">
            <span class="hidden sm:inline">Предыдущая</span>
            <span class="sm:hidden"><i class="fas fa-chevron-left"></i></span>
        </a>
        {% endif %}

        <div class="flex items-center mx-1 md:mx-3 text-sm md:text-base">
            <span class="hidden sm:inline">Страница</span>
            <input type="number" min="1" max="{{ pending_transactions.paginator.num_pages }}"
                value="{{ pending_transactions.number }}"
                class="input input-bordered input-sm md:input-md w-12 md:w-16 mx-1 md:mx-2 text-center transition-all duration-200 focus:ring-2 focus:ring-primary focus:border-transparent"
                onchange="window.location.href = '?connected_projects_page=' + this.value" aria-label="Номер страницы">
            <span>из {{ pending_transactions.paginator.num_pages }}</span>
        </div>

        {% if pending_transactions.has_next %}
        <a href="?transactions_page={{ pending_transactions.next_page_number }}"
            class="btn btn-sm md:btn-md btn-outline transition-all duration-200 hover:scale-[1.02]">
            <span class="hidden sm:inline">Следующая</span>
            <span class="sm:hidden"><i class="fas fa-chevron-right"></i></span>
        </a>
        <a href="?transactions_page={{ pending_transactions.paginator.num_pages }}"
            class="btn btn-sm btn-square md:btn-md btn-primary transition-all duration-200 hover:scale-105"
            aria-label="Последняя страница">
            <i class="fas fa-angle-double-right"></i>
        </a>
        {% endif %}
    </div>

</div>