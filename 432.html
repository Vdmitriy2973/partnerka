<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет партнера</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
</body>
<!-- Platforms Page -->
<div class="container mx-auto px-4 py-6 max-w-7xl">
<div id="platforms" class="page-section p-6">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-base-content mb-2">Мои площадки</h1>
        <p class="text-base-content/60">Добавляйте и управляйте своими источниками трафика (TikTok, YouTube, блоги, сайты и др.)</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div class="card bg-base-100 shadow-lg">
            <div class="card-body text-center">
                <i class="fas fa-layer-group text-3xl text-primary mb-2"></i>
                <div id="total-platforms" class="text-2xl font-bold">5</div>
                <p class="text-sm text-base-content/60">Всего площадок</p>
            </div>
        </div>
        <div class="card bg-base-100 shadow-lg">
            <div class="card-body text-center">
                <i class="fas fa-check-circle text-3xl text-success mb-2"></i>
                <div id="approved-platforms" class="text-2xl font-bold">3</div>
                <p class="text-sm text-base-content/60">Подтверждено</p>
            </div>
        </div>
        <div class="card bg-base-100 shadow-lg">
            <div class="card-body text-center">
                <i class="fas fa-hourglass-half text-3xl text-warning mb-2"></i>
                <div id="pending-platforms" class="text-2xl font-bold">2</div>
                <p class="text-sm text-base-content/60">Ожидают модерации</p>
            </div>
        </div>
    </div>

    <div class="card bg-base-100 shadow-lg">
        <div class="card-body">
            <div
                class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4"
            >
                <h2 class="card-title flex items-center gap-2">
                    <i class="fas fa-globe text-primary"></i>
                    Все площадки
                </h2>
                <button
                    id="btn-add-platform"
                    class="btn btn-primary flex items-center gap-2"
                >
                    <i class="fas fa-plus"></i>
                    Добавить площадку
                </button>
            </div>

            <div class="overflow-x-auto">
                <table class="table w-full">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>Тип</th>
                            <th>URL / ID</th>
                            <th>Статус</th>
                            <th>Дата добавления</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="platforms-tbody">
                        <!-- Площадки будут вставляться сюда -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal Add Platform -->
<div id="modal-add-platform" class="modal">
    <div class="modal-box relative max-w-lg">
        <label
            for="modal-add-platform"
            class="btn btn-sm btn-circle absolute right-2 top-2"
            id="btn-close-modal"
            >✕</label
        >
        <h3 class="text-lg font-bold mb-4">Добавить новую площадку</h3>

        <form id="form-add-platform" class="flex flex-col gap-4">
            <input
                type="text"
                id="platform-title"
                placeholder="Название площадки"
                class="input input-bordered w-full"
                required
            />

            <select
                id="platform-type"
                class="select select-bordered w-full"
                required
            >
                <option value="" disabled selected>Выберите тип площадки</option>
                <option value="website">Веб-сайт</option>
                <option value="tiktok">TikTok</option>
                <option value="youtube">YouTube</option>
                <option value="blog">Блог</option>
                <option value="telegram">Telegram</option>
                <option value="other">Другое</option>
            </select>

            <input
                type="text"
                id="platform-identifier"
                placeholder="URL или ID площадки"
                class="input input-bordered w-full"
                required
            />

            <button type="submit" class="btn btn-primary mt-2">
                Добавить площадку
            </button>
        </form>
    </div>
</div>
</div>
<script>
    // Инициализация списка площадок (пример, в реальности получаем с backend)
    let platforms = [
        {
            id: 1,
            title: "TikTok-канал",
            platform_type: "tiktok",
            identifier: "@tiktok_user123",
            status: "pending",
            created_at: "12.06.2025",
        },
        {
            id: 2,
            title: "Блог о путешествиях",
            platform_type: "blog",
            identifier: "travelblog.example.com",
            status: "approved",
            created_at: "01.06.2025",
        },
        {
            id: 3,
            title: "YouTube канал",
            platform_type: "youtube",
            identifier: "youtube.com/channel/XYZ",
            status: "approved",
            created_at: "05.06.2025",
        },
    ];

    const tbody = document.getElementById("platforms-tbody");
    const modal = document.getElementById("modal-add-platform");
    const btnAddPlatform = document.getElementById("btn-add-platform");
    const btnCloseModal = document.getElementById("btn-close-modal");
    const formAddPlatform = document.getElementById("form-add-platform");

    // Функция для обновления статистики сверху
    function updateStats() {
        document.getElementById("total-platforms").textContent = platforms.length;
        document.getElementById("approved-platforms").textContent = platforms.filter(p => p.status === "approved").length;
        document.getElementById("pending-platforms").textContent = platforms.filter(p => p.status === "pending").length;
    }

    // Функция для рендера таблицы площадок
    function renderPlatforms() {
        tbody.innerHTML = "";
        platforms.forEach(({ id, title, platform_type, identifier, status, created_at }) => {
            const tr = document.createElement("tr");

            const statusBadgeClass = {
                approved: "badge badge-success",
                pending: "badge badge-warning",
                rejected: "badge badge-error",
            }[status] || "badge";

            tr.innerHTML = `
                <td><strong>${title}</strong></td>
                <td>${platform_type.charAt(0).toUpperCase() + platform_type.slice(1)}</td>
                <td class="text-sm text-primary">${identifier}</td>
                <td><span class="${statusBadgeClass}">${status === "approved" ? "Подтверждена" : status === "pending" ? "На модерации" : "Отклонена"}</span></td>
                <td>${created_at}</td>
                <td>
                    <div class="dropdown dropdown-end">
                        <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                            <li><a href="#" class="edit-platform" data-id="${id}"><i class="fas fa-edit mr-2"></i>Редактировать</a></li>
                            <li><a href="#" class="delete-platform" data-id="${id}"><i class="fas fa-trash-alt mr-2"></i>Удалить</a></li>
                        </ul>
                    </div>
                </td>
            `;
            tbody.appendChild(tr);
        });
        updateStats();
    }

    // Показать модалку
    btnAddPlatform.addEventListener("click", () => {
        modal.classList.add("modal-open");
    });

    // Закрыть модалку
    btnCloseModal.addEventListener("click", () => {
        modal.classList.remove("modal-open");
        formAddPlatform.reset();
    });

    // Обработка отправки формы
    formAddPlatform.addEventListener("submit", (e) => {
        e.preventDefault();
        const title = document.getElementById("platform-title").value.trim();
        const platform_type = document.getElementById("platform-type").value;
        const identifier = document.getElementById("platform-identifier").value.trim();

        if (!title || !platform_type || !identifier) {
            alert("Пожалуйста, заполните все поля.");
            return;
        }

        // Добавляем новую площадку с статусом "pending"
        const newPlatform = {
            id: Date.now(),
            title,
            platform_type,
            identifier,
            status: "pending",
            created_at: new Date().toLocaleDateString('ru-RU'),
        };
        platforms.push(newPlatform);
        renderPlatforms();

        modal.classList.remove("modal-open");
        formAddPlatform.reset();
    });

    // Делегируем события на кнопки редактирования/удаления
    tbody.addEventListener("click", (e) => {
        if (e.target.closest(".delete-platform")) {
            e.preventDefault();
            const id = Number(e.target.closest(".delete-platform").dataset.id);
            if (confirm("Вы уверены, что хотите удалить эту площадку?")) {
                platforms = platforms.filter(p => p.id !== id);
                renderPlatforms();
            }
        } else if (e.target.closest(".edit-platform")) {
            e.preventDefault();
            alert("Функция редактирования пока не реализована");
            // Тут можно открыть форму редактирования с предзаполнением
        }
    });

    // Инициализация страницы
    renderPlatforms();
</script>
</body>
</html>